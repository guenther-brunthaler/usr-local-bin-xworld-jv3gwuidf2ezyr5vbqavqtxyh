#! /bin/sh

# Generate a password made of "Pronouncable Quintuplets" ("proquints"), except
# that the proquints are parsed into individual words (at their "-"
# boundaries) and then a simple integer counter is inserted between every
# adjacent two words: 256 bits without arguments, or 128 bits otherwise.
#
# The idea is that the embedded counter lets a human reader keep track of the
# current reading position easier, avoiding to skip words or duplicate them
# when manually typing in the pass phrase.
#
# Pass phrases generated by this script are generally recommended whenever a
# very secure (very long) pass phrase needs possibly to be typed in manually
# rather than by copy/paste.
#
# Uses neither /dev/random nor /dev/urandom, because both cannot guarantee any
# entropy any longer since Linux changed /dev/random in 2020 and made it
# basically the same as /dev/urandom.
#
# Instead, another script is used for providing the entropy, which gathers
# entropy using the HAVEGE algorithm and in addition uses a hardware random
# number generator, if one is available.
#
# Version 2025.341

set -e
trap 'test $? = 0 || echo "\"$0\" failed!" >& 2' 0

pwgen-with-entropy-harvesting-as-pronounceable ${1+"$@"} \
| awk -f /dev/fd/5 5<< 'EO_AWK'
{
	o = 2 * (i = NF) - 1; NF = o
	while (i != 1) {
		$o = $i; $(--o) = --i; --o
	}
	print
}
EO_AWK
